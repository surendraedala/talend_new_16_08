on: push

jobs:
  build-and-publish-to-cloud:
    runs-on: ubuntu-latest
    steps:
    # checkout the repo
    - uses: actions/checkout@v2
    - name: Set up JDK 11
      uses: actions/setup-java@v1
      with:
        java-version: 11
    - name: Build with Maven
      run: mvn -B package --file pom.xml install
    - name: Publish to GitHub Packages Apache Maven
      run: mvn deploy -s $GITHUB_WORKSPACE/settings.xml -DskipTests
      
    - name: 'Checkout Github Action'
      uses: actions/checkout@master
    
    - name: Publish to Talend Cloud
      uses: Talend/publish-to-cloud@master
      with:
        args: -e -am
        project: sfty_test
        updatesite_path: http:///jenkins/userContent/
        service_url: https://tmc.us.cloud.talend.com/inventory/
        cloud_token: ${{ secrets.CLOUD_TOKEN }}
        nexus_url: http://192.168.1.95:8081
        nexus_username: ${{ secrets.NEXUS_USERNAME }}
        nexus_password: ${{ secrets.NEXUS_PASSWORD }}
       # license_path: license.gpg
       # license_passphrase: ${{ secrets.LARGE_SECRET_PASSPHRASE }}
       
